<div class="min-h-screen w-full flex flex-col p-4 sm:p-6 lg:p-8 bg-gray-900 text-gray-100">
  <div class="w-full max-w-7xl mx-auto">
    @switch (auctionService.auctionState()) {
      @case ('login') {
        <div class="m-auto flex flex-col items-center justify-center w-full max-w-2xl text-center">
          <h1 class="text-4xl sm:text-5xl font-extrabold my-4 text-white w-full max-w-2xl">
            Hyva Premier League Auction 2026
          </h1>
        </div>

        <div class="bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-2xl w-full max-w-md mt-4 mx-auto">
          <h2 class="text-2xl font-bold mb-6 text-center text-gray-100">Auction Login</h2>
          <form (ngSubmit)="onLogin()">
            <div class="mb-4">
              <label for="username" class="block text-sm font-medium text-gray-300 mb-1">Username</label>
              <input type="text" id="username" name="username" [(ngModel)]="loginUsername"
                class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-100 focus:ring-blue-500 focus:border-blue-500 transition duration-200"
                placeholder="Enter username">
            </div>
            <div class="mb-6">
              <label for="password" class="block text-sm font-medium text-gray-300 mb-1">Password</label>
              <input type="password" id="password" name="password" [(ngModel)]="loginPassword"
                class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-100 focus:ring-blue-500 focus:border-blue-500 transition duration-200"
                placeholder="Enter password">
            </div>
            @if(auctionService.errorMessage()) {
              <div class="text-red-400 text-center text-sm mb-4" role="alert">
                {{ auctionService.errorMessage() }}
              </div>
            }
            <button type="submit"
              class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 text-lg flex items-center justify-center">
              <i data-lucide="log-in" class="w-5 h-5 mr-2"></i> Login
            </button>
          </form>
          <div class="flex items-center my-6">
            <hr class="flex-grow border-gray-600">
            <span class="mx-4 text-gray-400">or</span>
            <hr class="flex-grow border-gray-600">
          </div>
          <button (click)="onEnterPublicView()"
            class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 text-lg flex items-center justify-center">
            <i data-lucide="eye" class="w-5 h-5 mr-2"></i> Watch Auction Live
          </button>
        </div>
      }

      @case ('admin_lobby') {
        <!-- Main Header -->
        <div class="flex items-center justify-center mb-4 text-center">
          <h1 class="text-3xl sm:text-4xl font-extrabold text-white">
            Hyva Premier League Auction 2026
          </h1>
        </div>

        <!-- Sub Header -->
        <div class="bg-gray-800 rounded-lg shadow-lg p-3 mb-6 flex items-center justify-between">
          <h2 class="text-xl sm:text-2xl font-bold text-gray-100">Admin Lobby</h2>
          <button (click)="auctionService.logout()"
            class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 flex items-center">
            <i data-lucide="log-out" class="w-4 h-4 mr-2"></i>
            <span>Logout</span>
          </button>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          
          <!-- Column 1: Team Management -->
          <div class="bg-gray-800 rounded-lg p-6 shadow-md flex flex-col gap-6">
            <!-- Create Team Owner -->
            <div class="bg-gray-700/50 p-4 rounded-lg">
              <h3 class="text-lg font-semibold mb-4 text-gray-200 border-b border-gray-600 pb-2">Create Team Owner</h3>
              <form (ngSubmit)="onCreateTeam()" class="space-y-4">
                <input type="text" [(ngModel)]="newTeamName" name="newTeamName" placeholder="Team Name" class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-gray-100 placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500" required>
                <input type="text" [(ngModel)]="newOwnerName" name="newOwnerName" placeholder="Owner Name" class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-gray-100 placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500" required>
                <input type="text" [(ngModel)]="newUsername" name="newUsername" placeholder="Login Username" class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-gray-100 placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500" required>
                <input type="password" [(ngModel)]="newPassword" name="newPassword" placeholder="Login Password" class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-gray-100 placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500" required>
                 <div>
                    <label class="block text-sm font-medium text-gray-300 mb-1">Captain Role</label>
                    <select [(ngModel)]="newTeamCaptainRole" name="newTeamCaptainRole" class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-gray-100 focus:ring-blue-500 focus:border-blue-500">
                      <option value="Staff">Staff</option>
                      <option value="Technician">Technician</option>
                    </select>
                  </div>
                <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg flex items-center justify-center transition duration-200">
                  <i data-lucide="plus-circle" class="w-5 h-5 mr-2"></i> Create Team
                </button>
              </form>
            </div>
            <!-- Manage Teams -->
            <div class="bg-gray-700/50 p-4 rounded-lg flex-grow">
              <h3 class="text-lg font-semibold mb-4 text-gray-200 border-b border-gray-600 pb-2">Manage Teams</h3>
              <div class="space-y-3 max-h-[400px] overflow-y-auto pr-2">
                @for(team of auctionService.teams(); track team.id) {
                  @if(editingTeam()?.id === team.id) {
                    <!-- Edit Form -->
                     <div class="bg-gray-800 p-4 rounded-lg space-y-3">
                      <input type="text" [(ngModel)]="editTeamName" name="editTeamName" placeholder="Team Name" class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-gray-100">
                      <input type="text" [(ngModel)]="editOwnerName" name="editOwnerName" placeholder="Owner Name" class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-gray-100">
                      <input type="text" [(ngModel)]="editUsername" name="editUsername" placeholder="Username" class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-gray-100">
                      <input type="password" [(ngModel)]="editPassword" name="editPassword" placeholder="New Password (optional)" class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-gray-100">
                      <div class="flex gap-2">
                        <button (click)="onUpdateTeam()" class="flex-grow bg-blue-600 hover:bg-blue-700 text-white font-bold py-1 px-3 rounded text-sm">Save</button>
                        <button (click)="cancelEditing()" class="flex-grow bg-gray-500 hover:bg-gray-600 text-white font-bold py-1 px-3 rounded text-sm">Cancel</button>
                      </div>
                    </div>
                  } @else {
                    <!-- Display View -->
                    <div class="bg-gray-800/80 p-3 rounded-lg flex justify-between items-center">
                      <div>
                        <p class="font-bold text-white">{{ team.name }} <span [class]="getCaptainRoleColor(team.captainRole)" class="px-2 py-0.5 rounded-full text-xs font-semibold ml-2">{{ team.captainRole }}</span></p>
                        <p class="text-sm text-gray-400">Owner: {{ team.owner }} | User: {{ getUserForTeam(team.id)?.username }}</p>
                      </div>
                      <div class="flex gap-2">
                        <button (click)="startEditing(team)" class="p-2 bg-yellow-600 hover:bg-yellow-700 rounded-md text-white transition duration-200"><i data-lucide="edit" class="w-4 h-4"></i></button>
                        <button (click)="onDeleteTeam(team)" class="p-2 bg-red-600 hover:bg-red-700 rounded-md text-white transition duration-200"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                      </div>
                    </div>
                  }
                } @empty {
                  <p class="text-gray-400 text-center py-4">No teams created yet.</p>
                }
              </div>
            </div>
          </div>
          
          <!-- Column 2: Player Management -->
          <div class="bg-gray-800 rounded-lg p-6 shadow-md flex flex-col gap-6">
            <!-- Create Player -->
            <div class="bg-gray-700/50 p-4 rounded-lg">
              <h3 class="text-lg font-semibold mb-4 text-gray-200 border-b border-gray-600 pb-2">Create Player</h3>
              <form (ngSubmit)="onCreatePlayer()" class="space-y-4">
                 <input type="text" [(ngModel)]="newPlayerName" name="newPlayerName" placeholder="Player Name" class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-gray-100" required>
                 <select [(ngModel)]="newPlayerRole" name="newPlayerRole" class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-gray-100">
                    @for(role of playerRoles; track role) {
                      <option [value]="role">{{ role }}</option>
                    }
                  </select>
                <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg flex items-center justify-center transition duration-200">
                  <i data-lucide="user-plus" class="w-5 h-5 mr-2"></i> Create Player
                </button>
              </form>
            </div>
            <!-- Manage Players -->
            <div class="bg-gray-700/50 p-4 rounded-lg flex-grow">
              <h3 class="text-lg font-semibold mb-4 text-gray-200 border-b border-gray-600 pb-2">Manage Players ({{ auctionService.masterPlayerList().length }})</h3>
              <div class="space-y-2 max-h-[400px] overflow-y-auto pr-2">
                @for(player of auctionService.masterPlayerList(); track player.id) {
                   @if(editingPlayer()?.id === player.id) {
                    <!-- Edit Form -->
                    <div class="bg-gray-800 p-3 rounded-lg space-y-2">
                       <input type="text" [(ngModel)]="editPlayerName" name="editPlayerName" class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-gray-100">
                       <select [(ngModel)]="editPlayerRole" name="editPlayerRole" class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-gray-100">
                          @for(role of playerRoles; track role) {
                            <option [value]="role">{{ role }}</option>
                          }
                       </select>
                       <div class="flex gap-2">
                          <button (click)="onUpdatePlayer()" class="flex-grow bg-blue-600 hover:bg-blue-700 text-white font-bold py-1 px-3 rounded text-sm">Save</button>
                          <button (click)="cancelEditingPlayer()" class="flex-grow bg-gray-500 hover:bg-gray-600 text-white font-bold py-1 px-3 rounded text-sm">Cancel</button>
                       </div>
                    </div>
                  } @else {
                    <!-- Display View -->
                    <div class="bg-gray-800/80 p-3 rounded-lg flex justify-between items-center">
                       <div>
                          <p class="font-bold text-white">{{ player.name }}</p>
                          <p class="text-sm" [class]="getRoleColor(player.role)">{{ player.role }}</p>
                       </div>
                       <div class="flex gap-2">
                          <button (click)="startEditingPlayer(player)" class="p-2 bg-yellow-600 hover:bg-yellow-700 rounded-md text-white"><i data-lucide="edit" class="w-4 h-4"></i></button>
                          <button (click)="onDeletePlayer(player)" class="p-2 bg-red-600 hover:bg-red-700 rounded-md text-white"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                       </div>
                    </div>
                  }
                } @empty {
                  <p class="text-gray-400 text-center py-4">No players created yet.</p>
                }
              </div>
            </div>
          </div>
          
          <!-- Column 3: Auction Controls + Dice (Admin only) -->
          <div class="bg-gray-800 rounded-lg p-6 shadow-md flex flex-col items-center justify-center">
            <h3 class="text-xl font-bold text-white mb-6">Auction Control</h3>

            <!-- Dice visible here à¤ªà¤£ control à¤«à¤•à¥à¤¤ admin à¤•à¤¡à¥‡ -->
            <div class="w-full mb-6 bg-gray-700/60 rounded-xl p-4">
              <h4 class="text-md font-semibold text-gray-200 mb-3 text-center">
                Dice (Roll Order)
              </h4>
              <div class="flex justify-center">
                <app-dice />
              </div>
            </div>

            <p class="text-gray-300 text-center mb-6">
              Manage teams and players, then start the auction when ready.
            </p>
            <button (click)="onStartAuction()" 
                    [disabled]="auctionService.teams().length < 4 || auctionService.masterPlayerList().length === 0"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-lg text-xl flex items-center justify-center transition duration-200 disabled:bg-gray-500 disabled:cursor-not-allowed">
              <i data-lucide="gavel" class="w-6 h-6 mr-3"></i> Start Auction
            </button>
             @if(auctionService.teams().length < 4) {
              <p class="text-yellow-400 text-sm mt-4 text-center">You need at least 4 teams to start the auction.</p>
            }
            @if(auctionService.masterPlayerList().length === 0) {
              <p class="text-yellow-400 text-sm mt-4 text-center">You need to add players before starting.</p>
            }
          </div>
        </div>
      }

      @case ('admin_view') {
        <!-- Main Header -->
        <div class="flex items-center justify-center mb-4 text-center">
          <h1 class="text-3xl sm:text-4xl font-extrabold text-white">
            Hyva Premier League Auction 2026
          </h1>
        </div>

        <!-- Sub Header -->
        <div class="bg-gray-800 rounded-lg shadow-lg p-3 mb-6 flex items-center justify-between">
          <h2 class="text-xl sm:text-2xl font-bold text-gray-100">Admin Dashboard - Round {{ auctionService.currentRound() }}</h2>
          <div class="flex items-center gap-2">
            <button (click)="onStopAuction()" class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 flex items-center text-sm">
                <i data-lucide="stop-circle" class="w-4 h-4 mr-2"></i> Stop Auction
            </button>
            <button (click)="auctionService.logout()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 flex items-center text-sm">
                <i data-lucide="log-out" class="w-4 h-4 mr-2"></i> Logout
            </button>
          </div>
        </div>
        
        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <!-- Left Column: Auction Controls + Dice -->
          <div class="bg-gray-800 rounded-lg p-6 shadow-md flex flex-col gap-6">
            <div class="text-center bg-gray-700/50 p-4 rounded-lg">
              <h3 class="text-lg font-semibold mb-4 text-gray-200">Auction Control</h3>
              <app-dice />
              @if(auctionService.roundOrder().length < auctionService.TEAMS_PER_ROUND) {
                <button (click)="onRollForNextPick()" [disabled]="auctionService.isRolling()" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200 disabled:bg-gray-500 disabled:cursor-not-allowed text-lg">
                  Roll for Pick {{ auctionService.roundOrder().length + 1 }}
                </button>
              } @else {
                 <button (click)="onNextRound()" [disabled]="!auctionService.isRoundCompleted()" class="mt-4 w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200 disabled:bg-gray-500 disabled:cursor-not-allowed text-lg">
                  Next Round
                </button>
              }
               <button (click)="onUndoLastDraft()" [disabled]="!auctionService.canUndo()" class="mt-2 w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 disabled:bg-gray-500 disabled:cursor-not-allowed text-sm">
                  Undo Last Pick
               </button>
            </div>
            
            <div class="bg-gray-700/50 p-4 rounded-lg">
                <h3 class="text-lg font-semibold mb-3 text-gray-200">Pick Order (Round {{ auctionService.currentRound() }})</h3>
                <div class="space-y-2">
                  @for(team of auctionService.roundOrder(); track team.id; let i = $index) {
                    <div class="p-2 rounded-lg text-white font-semibold flex items-center" [class.bg-green-600]="auctionService.pickingTeam()?.id === team.id" [class.bg-gray-600]="auctionService.pickingTeam()?.id !== team.id" [class.opacity-50]="auctionService.turnIndex() > i">
                      <span class="mr-3 font-bold text-lg">{{ i + 1 }}.</span>
                      <i [attr.data-lucide]="team.logo" class="w-5 h-5 mr-2"></i>
                      <span>{{ team.name }}</span>
                    </div>
                  }
                  @for(placeholder of [].constructor(auctionService.TEAMS_PER_ROUND - auctionService.roundOrder().length); track $index) {
                     <div class="p-2 rounded-lg bg-gray-800/50 text-gray-500 font-semibold flex items-center animate-pulse">
                      <span class="mr-3 font-bold text-lg">{{ auctionService.roundOrder().length + $index + 1 }}.</span>
                      <i data-lucide="hourglass" class="w-5 h-5 mr-2"></i>
                      <span>Awaiting roll...</span>
                    </div>
                  }
                </div>
            </div>
          </div>
          
          <!-- Middle Column: Available Players -->
          <div class="bg-gray-800 rounded-lg p-6 shadow-md">
            <h3 class="text-lg font-semibold mb-4 text-gray-200">Available Players ({{ auctionService.availablePlayers().length }})</h3>
            <div class="space-y-2 max-h-[600px] overflow-y-auto pr-2">
              @for(player of auctionService.availablePlayers(); track player.id) {
                 <div class="bg-gray-700/80 p-3 rounded-lg flex justify-between items-center">
                   <div>
                      <p class="font-bold text-white">{{ player.name }}</p>
                      <p class="text-sm" [class]="getRoleColor(player.role)">{{ player.role }}</p>
                   </div>
                </div>
              } @empty {
                <p class="text-gray-400 text-center py-4">No more players available.</p>
              }
            </div>
          </div>
          
          <!-- Right Column: Team Rosters -->
          <div class="bg-gray-800 rounded-lg p-6 shadow-md">
            <h3 class="text-lg font-semibold mb-4 text-gray-200">Team Rosters</h3>
            <div class="space-y-4 max-h-[600px] overflow-y-auto pr-2">
              @for(team of auctionService.teams(); track team.id) {
                <div class="bg-gray-700/50 p-3 rounded-lg">
                    <h4 class="font-bold text-white mb-2 flex items-center">
                      <i [attr.data-lucide]="team.logo" class="w-5 h-5 mr-2"></i>
                      {{ team.name }} ({{team.players.length}})
                      <span [class]="getCaptainRoleColor(team.captainRole)" class="px-2 py-0.5 rounded-full text-xs font-semibold ml-2">{{ team.captainRole }}</span>
                    </h4>
                    <ul class="list-disc list-inside text-gray-300 text-sm pl-2">
                        @for(player of team.players; track player.id) {
                           <li>{{ player.name }} <span class="text-xs" [class]="getRoleColor(player.role)">({{ player.role }})</span></li>
                        } @empty {
                            <li class="list-none text-gray-500">No players drafted.</li>
                        }
                    </ul>
                </div>
              }
            </div>
          </div>
        </div>
      }

      @case ('team_view') {
        @let team = currentUserTeam();
        @if(team) {
          <!-- Main Header -->
          <div class="flex items-center justify-center mb-4 text-center">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-white">
              Hyva Premier League Auction 2026
            </h1>
          </div>
          <!-- Sub Header -->
          <div class="bg-gray-800 rounded-lg shadow-lg p-3 mb-6 flex items-center justify-between">
            <h2 class="text-xl sm:text-2xl font-bold text-white flex items-center">
                <i [attr.data-lucide]="team.logo" class="w-7 h-7 mr-3"></i>
                {{ team.name }} - Team Dashboard
            </h2>
            <button (click)="auctionService.logout()"
              class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 flex items-center">
              <i data-lucide="log-out" class="w-4 h-4 mr-2"></i>
              <span>Logout</span>
            </button>
          </div>

           @if(auctionService.isMyTurn()) {
            <div class="bg-green-600 text-white text-2xl font-bold p-4 rounded-lg text-center mb-6 animate-pulse">
                IT'S YOUR TURN TO PICK!
            </div>
           } @else if(auctionService.pickingTeam()) {
             <div class="bg-yellow-600 text-white text-xl font-bold p-4 rounded-lg text-center mb-6">
                {{ auctionService.pickingTeam()?.name }} is now picking...
            </div>
           }

          <!-- Main Content Grid -->
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column: Dice + Auction Info -->
            <div class="bg-gray-800 rounded-lg p-6 shadow-md">
              <h3 class="text-lg font-semibold mb-3 text-gray-200 flex items-center justify-between">
                <span>Dice & Pick Order (Round {{ auctionService.currentRound() }})</span>
              </h3>

              <!-- Dice visible for Team view -->
              <div class="mb-4 flex justify-center">
                <app-dice />
              </div>

              <h4 class="text-md font-semibold mb-3 text-gray-200">Pick Order</h4>
              <div class="space-y-2">
                @for(pick of auctionService.roundOrder(); track pick.id; let i = $index) {
                  <div class="p-2 rounded-lg text-white font-semibold flex items-center" [class.bg-green-600]="auctionService.pickingTeam()?.id === pick.id" [class.bg-gray-600]="auctionService.pickingTeam()?.id !== pick.id" [class.opacity-50]="auctionService.turnIndex() > i">
                    <span class="mr-3 font-bold text-lg">{{ i + 1 }}.</span>
                    <i [attr.data-lucide]="pick.logo" class="w-5 h-5 mr-2"></i>
                    <span>{{ pick.name }}</span>
                  </div>
                }
                 @for(placeholder of [].constructor(auctionService.TEAMS_PER_ROUND - auctionService.roundOrder().length); track $index) {
                     <div class="p-2 rounded-lg bg-gray-800/50 text-gray-500 font-semibold flex items-center animate-pulse">
                      <span class="mr-3 font-bold text-lg">{{ auctionService.roundOrder().length + $index + 1 }}.</span>
                      <i data-lucide="hourglass" class="w-5 h-5 mr-2"></i>
                      <span>Awaiting roll...</span>
                    </div>
                  }
              </div>
            </div>

            <!-- Middle Column: Available Players -->
            <div class="bg-gray-800 rounded-lg p-6 shadow-md">
              <h3 class="text-lg font-semibold mb-4 text-gray-200">Available Players ({{ auctionService.availablePlayers().length }})</h3>
              <div class="space-y-2 max-h-[600px] overflow-y-auto pr-2">
                 @for(player of auctionService.availablePlayers(); track player.id) {
                   <div class="bg-gray-700/80 p-3 rounded-lg flex justify-between items-center">
                     <div>
                        <p class="font-bold text-white">{{ player.name }}</p>
                        <p class="text-sm" [class]="getRoleColor(player.role)">{{ player.role }}</p>
                     </div>
                     @if(auctionService.isMyTurn()) {
                       <button (click)="onDraftPlayer(player)" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-3 rounded-lg text-sm flex items-center">
                         <i data-lucide="plus" class="w-4 h-4 mr-1"></i> Draft
                       </button>
                     }
                  </div>
                } @empty {
                   <p class="text-gray-400 text-center py-4">No more players available.</p>
                }
              </div>
            </div>

            <!-- Right Column: Team Rosters -->
            <div class="bg-gray-800 rounded-lg p-6 shadow-md">
              <h3 class="text-lg font-semibold mb-4 text-gray-200">Team Rosters</h3>
              <div class="space-y-4 max-h-[600px] overflow-y-auto pr-2">
                 @for(t of auctionService.teams(); track t.id) {
                  <div class="bg-gray-700/50 p-3 rounded-lg" [class.border-2]="t.id === team.id" [class.border-green-500]="t.id === team.id">
                      <h4 class="font-bold text-white mb-2 flex items-center">
                        <i [attr.data-lucide]="t.logo" class="w-5 h-5 mr-2"></i>
                        {{ t.name }} ({{t.players.length}})
                         <span [class]="getCaptainRoleColor(t.captainRole)" class="px-2 py-0.5 rounded-full text-xs font-semibold ml-2">{{ t.captainRole }}</span>
                      </h4>
                      <ul class="list-disc list-inside text-gray-300 text-sm pl-2">
                           @for(player of t.players; track player.id) {
                           <li>{{ player.name }} <span class="text-xs" [class]="getRoleColor(player.role)">({{ player.role }})</span></li>
                        } @empty {
                            <li class="list-none text-gray-500">No players drafted.</li>
                        }
                      </ul>
                  </div>
                }
              </div>
            </div>
          </div>
        }
      }
      
      @case ('public_view') {
        <!-- Main Header -->
        <div class="flex items-center justify-center mb-4 text-center">
          <h1 class="text-3xl sm:text-4xl font-extrabold text-white">
            Hyva Premier League Auction 2026
          </h1>
        </div>
        <!-- Sub Header -->
        <div class="bg-gray-800 rounded-lg shadow-lg p-3 mb-6 flex items-center justify-between">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-100">Spectator View - Round {{ auctionService.currentRound() }}</h2>
            <button (click)="onReturnToLogin()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 flex items-center text-sm">
                <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i> Back to Login
            </button>
        </div>

        @if(auctionService.pickingTeam()) {
            <div class="bg-gray-700 text-white text-xl p-4 rounded-lg text-center mb-6">
                <span class="font-bold">{{ auctionService.pickingTeam()?.name }}</span> is now picking...
            </div>
        }

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column: Dice + Auction Info -->
            <div class="bg-gray-800 rounded-lg p-6 shadow-md">
                <h3 class="text-lg font-semibold mb-3 text-gray-200 flex items-center justify-between">
                  <span>Dice & Pick Order (Round {{ auctionService.currentRound() }})</span>
                </h3>

                <!-- Dice visible in public view -->
                <div class="mb-4 flex justify-center">
                  <app-dice />
                </div>

                <h4 class="text-md font-semibold mb-3 text-gray-200">Pick Order</h4>
                <div class="space-y-2">
                    @for(pick of auctionService.roundOrder(); track pick.id; let i = $index) {
                      <div class="p-2 rounded-lg text-white font-semibold flex items-center" [class.bg-green-600]="auctionService.pickingTeam()?.id === pick.id" [class.bg-gray-600]="auctionService.pickingTeam()?.id !== pick.id" [class.opacity-50]="auctionService.turnIndex() > i">
                        <span class="mr-3 font-bold text-lg">{{ i + 1 }}.</span>
                        <i [attr.data-lucide]="pick.logo" class="w-5 h-5 mr-2"></i>
                        <span>{{ pick.name }}</span>
                      </div>
                    }
                    @for(placeholder of [].constructor(auctionService.TEAMS_PER_ROUND - auctionService.roundOrder().length); track $index) {
                        <div class="p-2 rounded-lg bg-gray-800/50 text-gray-500 font-semibold flex items-center">
                            <span class="mr-3 font-bold text-lg">{{ auctionService.roundOrder().length + $index + 1 }}.</span>
                            <i data-lucide="hourglass" class="w-5 h-5 mr-2"></i>
                            <span>Awaiting roll...</span>
                        </div>
                    }
                </div>
            </div>

            <!-- Middle Column: Available Players -->
            <div class="bg-gray-800 rounded-lg p-6 shadow-md">
                <h3 class="text-lg font-semibold mb-4 text-gray-200">Available Players ({{ auctionService.availablePlayers().length }})</h3>
                <div class="space-y-2 max-h-[600px] overflow-y-auto pr-2">
                    @for(player of auctionService.availablePlayers(); track player.id) {
                      <div class="bg-gray-700/80 p-3 rounded-lg flex justify-between items-center">
                        <div>
                            <p class="font-bold text-white">{{ player.name }}</p>
                            <p class="text-sm" [class]="getRoleColor(player.role)">{{ player.role }}</p>
                        </div>
                      </div>
                    } @empty {
                       <p class="text-gray-400 text-center py-4">No more players available.</p>
                    }
                </div>
            </div>

            <!-- Right Column: Team Rosters -->
            <div class="bg-gray-800 rounded-lg p-6 shadow-md">
                <h3 class="text-lg font-semibold mb-4 text-gray-200">Team Rosters</h3>
                <div class="space-y-4 max-h-[600px] overflow-y-auto pr-2">
                    @for(team of auctionService.teams(); track team.id) {
                      <div class="bg-gray-700/50 p-3 rounded-lg">
                          <h4 class="font-bold text-white mb-2 flex items-center">
                              <i [attr.data-lucide]="team.logo" class="w-5 h-5 mr-2"></i>
                              {{ team.name }} ({{team.players.length}})
                               <span [class]="getCaptainRoleColor(team.captainRole)" class="px-2 py-0.5 rounded-full text-xs font-semibold ml-2">{{ team.captainRole }}</span>
                          </h4>
                          <ul class="list-disc list-inside text-gray-300 text-sm pl-2">
                               @for(player of team.players; track player.id) {
                                  <li>{{ player.name }} <span class="text-xs" [class]="getRoleColor(player.role)">({{ player.role }})</span></li>
                               } @empty {
                                   <li class="list-none text-gray-500">No players drafted.</li>
                               }
                          </ul>
                      </div>
                    }
                </div>
            </div>
        </div>
      }

      @case ('auction_ended') {
        <!-- Main Header -->
        <div class="flex items-center justify-center mb-4 text-center">
          <h1 class="text-3xl sm:text-4xl font-extrabold text-white">
            Hyva Premier League Auction 2026
          </h1>
        </div>
         <!-- Sub Header -->
        <div class="bg-gray-800 rounded-lg shadow-lg p-3 mb-6 flex items-center justify-between">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-100">Auction Concluded</h2>
            <div>
              @if(auctionService.currentUser()?.role === 'admin') {
                <button (click)="onResetAuction()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 flex items-center text-sm mr-2">
                    <i data-lucide="refresh-cw" class="w-4 h-4 mr-2"></i> Start New Auction
                </button>
              }
               <button (click)="auctionService.logout()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 flex items-center text-sm">
                  <i data-lucide="log-out" class="w-4 h-4 mr-2"></i> Logout
              </button>
            </div>
        </div>

        <!-- Export buttons -->
        <div class="flex flex-wrap gap-2 justify-center mb-4">
          @if(auctionService.currentUser()?.role === 'admin') {
            <button
              (click)="exportDraftToExcelAll()"
              class="px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold rounded-lg text-sm flex items-center"
            >
              <i data-lucide="file-spreadsheet" class="w-4 h-4 mr-2"></i>
              Export All Teams (Excel)
            </button>
          }
          @if(auctionService.currentUser()?.role === 'team_owner') {
            <button
              (click)="exportDraftToExcelMine()"
              class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg text-sm flex items-center"
            >
              <i data-lucide="file-spreadsheet" class="w-4 h-4 mr-2"></i>
              Export My Team (Excel)
            </button>
          }
          <button
            (click)="exportDraftToPng()"
            class="px-4 py-2 bg-gray-700 hover:bg-gray-800 text-white font-semibold rounded-lg text-sm flex items-center"
          >
            <i data-lucide="image" class="w-4 h-4 mr-2"></i>
            Export as PNG
          </button>
        </div>

        <h3 class="text-2xl font-bold text-center text-green-400 mb-6">Final Team Rosters</h3>

        <div #exportTable class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
           @for(team of auctionService.teams(); track team.id) {
            <div class="bg-gray-800 rounded-lg p-6 shadow-md">
                <h4 class="font-bold text-white mb-3 flex items-center text-lg border-b border-gray-700 pb-2">
                    <i [attr.data-lucide]="team.logo" class="w-6 h-6 mr-3"></i>
                    {{ team.name }}
                     <span [class]="getCaptainRoleColor(team.captainRole)" class="px-2 py-0.5 rounded-full text-xs font-semibold ml-auto">{{ team.captainRole }}</span>
                </h4>
                <div class="space-y-2 max-h-[400px] overflow-y-auto pr-2">
                     @for(player of team.players; track player.id) {
                        <div class="bg-gray-700/80 p-2 rounded-lg">
                            <p class="font-semibold text-white">{{ player.name }}</p>
                            <p class="text-sm" [class]="getRoleColor(player.role)">{{ player.role }}</p>
                        </div>
                    } @empty {
                       <p class="text-gray-500 text-center py-4">No players were drafted.</p>
                    }
                </div>
            </div>
           }
        </div>
      }
    }
  </div>
<!-- Draft Announcement Popup -->
@if (auctionService.lastDraftedPlayerInfo(); as draft) {
  <div class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 animate-fade-in">
    <div
      class="bg-gray-800 rounded-2xl shadow-2xl p-8 border-4 animate-scale-up text-center w-full max-w-lg"
      [class]="draft.team.color"
    >
      <p class="text-2xl font-bold text-gray-200">{{ draft.player.name }}</p>
      <p class="text-lg" [class]="getRoleColor(draft.player.role)">
        {{ draft.player.role }}
      </p>
      <p class="mt-4 text-gray-400">Selected by</p>
      <p class="text-3xl font-extrabold" [class]="getTextColor(draft.team.color)">
        {{ draft.team.name }}
      </p>

      <!-- ðŸ‘‡ à¤¹à¥‡ à¤¨à¤µà¥€à¤¨ à¤¬à¤Ÿà¤£ -->
      <button
        (click)="closeDraftAnnouncement()"
        class="mt-6 px-4 py-2 bg-black/40 hover:bg-black/60 text-white font-semibold rounded-lg text-sm inline-flex items-center gap-2"
      >
        <i data-lucide="x-circle" class="w-4 h-4"></i>
        Close
      </button>
    </div>
  </div>
}
